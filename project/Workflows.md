# Workflows: Autonomous Bug Bounty Orchestrator

## Table of Contents
1. [System Initialization](#1-system-initialization)
2. [Protocol Registration Flow](#2-protocol-registration-flow)
3. [Vulnerability Scanning Flow](#3-vulnerability-scanning-flow)
4. [Exploit Validation Flow](#4-exploit-validation-flow)
5. [Bounty Payment Flow](#5-bounty-payment-flow)
6. [Agent-to-Agent Communication](#6-agent-to-agent-communication)
7. [Dashboard Real-time Updates](#7-dashboard-real-time-updates)
8. [Error Handling & Recovery](#8-error-handling--recovery)

---

## 1. System Initialization

**Hybrid Setup:** Local Anvil (targets + sandbox) + Base Sepolia (payments)


```
┌───────────────────────────────────────────────────┐                                                                                                                                           
│                                                   │                                                                                                                                           
│                   System Startup                  │                                                                                                                                           
│                                                   │                                                                                                                                           
└─────────────────────────┬─────────────────────────┘                                                                                                                                           
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          ▼                                                                                                                                                                     
┌───────────────────────────────────────────────────┐                                                                                                                                           
│                                                   │                                                                                                                                           
│           Load Environment<br/>Variables          │                                                                                                                                           
│                                                   │                                                                                                                                           
└─────────────────────────┬─────────────────────────┘                                                                                                                                           
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          ▼                                                                                                                                                                     
┌───────────────────────────────────────────────────┐                                                                                                                                           
│                                                   │                                                                                                                                           
│  Initialize PostgreSQL<br/>Run Prisma Migrations  │                                                                                                                                           
│                                                   │                                                                                                                                           
└─────────────────────────┬─────────────────────────┘                                                                                                                                           
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          ▼                                                                                                                                                                     
┌───────────────────────────────────────────────────┐                                                                                                                                           
│                                                   │                                                                                                                                           
│       Connect to Redis<br/>Initialize Queues      │                                                                                                                                           
│                                                   │                                                                                                                                           
└─────────────────────────┬─────────────────────────┘                                                                                                                                           
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          ▼                                                                                                                                                                     
┌───────────────────────────────────────────────────┐                                                                                                                                           
│                                                   │                                                                                                                                           
│           Start Services<br/>in Parallel          │  ├───────┬─────────────────────┐                                                                                                          
│                                                   │          │                     │                                                                                                          
└─────────────────────────┬─────────────────────────┘          └─────────────────────┼──────────────────────────────────────────────────┐                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          ▼                                                          ▼                                                  ▼                                                       
┌───────────────────────────────────────────────────┐          ┌───────────────────────────────────────────┐         ┌─────────────────────────────────────┐                                    
│                                                   │          │                                           │         │                                     │                                    
│          Start Express API<br/>Port 4000          │          │ Initialize Socket.io<br/>WebSocket Server │         │       Start BullMQ<br/>Workers      │                                    
│                                                   │          │                                           │         │                                     │                                    
└─────────────────────────┬─────────────────────────┘          └─────────────────────┬─────────────────────┘         └──────────────────┬──────────────────┘                                    
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          ▼                                                          ▼                                                  ▼                                                       
┌───────────────────────────────────────────────────┐          ┌───────────────────────────────────────────┐         ┌─────────────────────────────────────┐                                    
│                                                   │          │                                           │         │                                     │                                    
│                  API Health Check                 │          │              WebSocket Ready              │         │         Queue Workers Active        │                                    
│                                                   │          │                                           │         │                                     │                                    
└─────────────────────────┬─────────────────────────┘          └─────────────────────┬─────────────────────┘         └──────────────────┬──────────────────┘                                    
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          ▼                                                          │                                                  │                                                       
┌───────────────────────────────────────────────────┐                                │                                                  │                                                       
│                                                   │                                │                                                  │                                                       
│                    SpawnAgents                    │  ├◄──────┬─────────────────────┼──────────────────────────────────────────────────┘                                                       
│                                                   │          │                     │                                                                                                          
└─────────────────────────┬─────────────────────────┘          └─────────────────────┼──────────────────────────────────────────────────┐                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          ▼                                                          ▼                                                  ▼                                                       
┌───────────────────────────────────────────────────┐          ┌───────────────────────────────────────────┐         ┌─────────────────────────────────────┐                                    
│                                                   │          │                                           │         │                                     │                                    
│           Initialize<br/>Protocol Agent           │          │      Initialize<br/>Researcher Agent      │         │    Initialize<br/>Validator Agent   │                                    
│                                                   │          │                                           │         │                                     │                                    
└─────────────────────────┬─────────────────────────┘          └─────────────────────┬─────────────────────┘         └──────────────────┬──────────────────┘                                    
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          │                                                          │                                                  │                                                       
                          ▼                                                          │                                                  │                                                       
┌───────────────────────────────────────────────────┐                                │                                                  │                                                       
│                                                   │                                │                                                  │                                                       
│            Agent-to-Agent<br/>Bus Ready           │   ◄────────────────────────────┴──────────────────────────────────────────────────┘                                                       
│                                                   │                                                                                                                                           
└─────────────────────────┬─────────────────────────┘                                                                                                                                           
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          ▼                                                                                                                                                                     
┌───────────────────────────────────────────────────┐                                                                                                                                           
│                                                   │                                                                                                                                           
│             Connect to<br/>Both Chains            │  ├─────────────────────────────┐                                                                                                          
│                                                   │                                │                                                                                                          
└─────────────────────────┬─────────────────────────┘                                │                                                                                                          
                          │                                                          │                                                                                                          
                          │                                                          │                                                                                                          
                          │                                                          │                                                                                                          
                          │                                                          │                                                                                                          
                          ▼                                                          ▼                                                                                                          
┌───────────────────────────────────────────────────┐          ┌───────────────────────────────────────────┐                                                                                    
│                                                   │          │                                           │                                                                                    
│ Connect Local Anvil<br/>Chain 31337<br/>Port 8545 │  Fail─┐  │    Connect Base Sepolia<br/>Chain 84532   ├◄─Fail───┬Success───────────┬───────────────────────────────────────┐               
│                                                   │       │  │                                           │         │                  │                                       │               
└─────────────────────────┬─────────────────────────┘       │  └───────────────────────────────────────────┘         └──────────────────┼───────────────────────────────────────┤               
                          │                                 │                                                                           │                                       │               
                          │                                 │                                                                           │                                       │               
                       Success                              └────────────────────────┐                                                  │                                       │               
                          │                                                          │                                                  │                                       │               
                          ▼                                                          ▼                                                  ▼                                       ▼               
┌───────────────────────────────────────────────────┐          ┌───────────────────────────────────────────┐         ┌─────────────────────────────────────┐     ┌──────────────┴──────────────┐
│                                                   │          │                                           │         │                                     │     │                             │
│          Anvil Ready<br/>Target Contracts         │   ◄──────┤          Start Anvil<br/>Locally          │         │ Sepolia Ready<br/>Payment Contracts │     │ Retry with<br/>Fallback RPC │
│                                                   │          │                                           │         │                                     │     │                             │
└─────────────────────────┬─────────────────────────┘          └───────────────────────────────────────────┘         └──────────────────┬──────────────────┘     └─────────────────────────────┘
                          │                                                                                                             │                                                       
                          │                                                                                                             │                                                       
                          │                                                                                                             │                                                       
                          │                                                                                                             │                                                       
                          ▼                                                                                                             │                                                       
┌───────────────────────────────────────────────────┐          ┌───────────────────────────────────────────┐                            │                                                       
│                                                   │          │                                           │                            │                                                       
│         Start Sandbox Anvil<br/>Port 8546         │  ├──────►│           Both Chains<br/>Ready?          │◄───────────────────────────┘                                                       
│                                                   │          │                                           │                                                                                    
└───────────────────────────────────────────────────┘          └─────────────────────┬─────────────────────┘                                                                                    
                                                                                     │                                                                                                          
                                                                                     │                                                                                                          
                                                                                     │                                                                                                          
                                                                                     │                                                                                                          
                                                                                     │                                                                                                          
┌───────────────────────────────────────────────────┐                                │                                                                                                          
│                                                   │                                │                                                                                                          
│       Load Contract ABIs<br/>Anvil + Sepolia      │   ◄────────────────────────────┘                                                                                                          
│                                                   │                                                                                                                                           
└─────────────────────────┬─────────────────────────┘                                                                                                                                           
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          │                                                                                                                                                                     
                          ▼                                                                                                                                                                     
┌───────────────────────────────────────────────────┐                                                                                                                                           
│                                                   │                                                                                                                                           
│        System Ready<br/>Accepting Requests        │                                                                                                                                           
│                                                   │                                                                                                                                           
└───────────────────────────────────────────────────┘                                                                                                                                           
```


---

## 2. Protocol Registration Flow

**GitHub-Based Registration:** Protocols submit GitHub repo URLs, not deployed contract addresses.


```
┌─────────────────────────────────────────────────────────────────┐                                                             
│                     "Frontend - Dashboard"                      │                                                             
│                                                                 │                                                             
│                                                                 │                                                             
│ ┌─────────────────────────────────────────────────────────────┐ │                                                             
│ │                                                             │ │                                                             
│ │                        Protocol Owner                       │ │                                                             
│ │                                                             │ │                                                             
│ └──────────────────────────────┬──────────────────────────────┘ │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                ▼                                │                                                             
│ ┌─────────────────────────────────────────────────────────────┐ │                                                             
│ │                                                             │ │                                                             
│ │ Fill Registration Form<br/>GitHub URL, Contract Path, Terms │ │                                                             
│ │                                                             │ │                                                             
│ └──────────────────────────────┬──────────────────────────────┘ │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                ▼                                │                                                             
│ ┌─────────────────────────────────────────────────────────────┐ │                                                             
│ │                                                             │ │                                                             
│ │                        Submit to API                        │ │                                                             
│ │                                                             │ │                                                             
│ └──────────────────────────────┬──────────────────────────────┘ │                                                             
│                                │                                │                                                             
└────────────────────────────────┼────────────────────────────────┘                                                             
                                 │                                                                                              
                                 │                                                                                              
                                 │                                                                                              
┌────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────┐
│                                │                   "Backend - API Layer"                                                     │
│                                │                                                                                             │
│                                ▼                                                                                             │
│ ┌─────────────────────────────────────────────────────────────┐                                                              │
│ │                                                             │                                                              │
│ │                Validate Input<br/>Zod Schema                │    ├──────────────Valid───────────────┐                      │
│ │                                                             │                                       │                      │
│ └──────────────────────────────┬──────────────────────────────┘                                       │                      │
│                                │                                                                      │                      │
│                                │                                                                      │                      │
│                             Invalid                                                                   │                      │
│                                │                                                                      │                      │
│                                ▼                                                                      ▼                      │
│ ┌─────────────────────────────────────────────────────────────┐                 ┌──────────────────────────────────────────┐ │
│ │                                                             │                 │                                          │ │
│ │               Return 400<br/>Validation Error               │             ┌Yes┤    GitHub URL Already<br/>Registered?    │ │
│ │                                                             │             │   │                                          │ │
│ └─────────────────────────────────────────────────────────────┘             │   └─────────────────────┬────────────────────┘ │
│                                                                             │                         │                      │
│                                                                             │                         │                      │
│                                ┌────────────────────────────────────────────┘                        No                      │
│                                │                                                                      │                      │
│                                ▼                                                                      ▼                      │
│ ┌─────────────────────────────────────────────────────────────┐                 ┌──────────────────────────────────────────┐ │
│ │                                                             │                 │                                          │ │
│ │                Return 409<br/>Already Exists                │                 │        Queue Registration<br/>Job        │ │
│ │                                                             │                 │                                          │ │
│ └─────────────────────────────────────────────────────────────┘                 └─────────────────────┬────────────────────┘ │
│                                                                                                       │                      │
└───────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────────────┘
                                                                                                        │                       
                                                                                                        │                       
                                                                                                        │                       
┌───────────────────────────────────────────────────────────────────────────────────────────────────────┼──────────────────────┐
│                                               "Agent Layer - Protocol Agent"                          │                      │
│                                                                                                       │                      │
│                                                                                                       │                      │
│ ┌─────────────────────────────────────────────────────────────┐                                       │                      │
│ │                                                             │                                       │                      │
│ │               Protocol Agent<br/>Receives Task              │     ◄─────────────────────────────────┘                      │
│ │                                                             │                                                              │
│ └──────────────────────────────┬──────────────────────────────┘                                                              │
│                                │                                                                                             │
│                                │                                                                                             │
│                                │                                                                                             │
│                                │                                                                                             │
│                                ▼                                                                                             │
│ ┌─────────────────────────────────────────────────────────────┐                                                              │
│ │                                                             │                                                              │
│ │       Clone GitHub Repo<br/>at Specified Branch/Commit      │    ├──────────────Valid───────────────┐                      │
│ │                                                             │                                       │                      │
│ └──────────────────────────────┬──────────────────────────────┘                                       │                      │
│                                │                                                                      │                      │
│                                │                                                                      │                      │
│                             Invalid                                                                   │                      │
│                                │                                                                      │                      │
│                                ▼                                                                      ▼                      │
│ ┌─────────────────────────────────────────────────────────────┐                 ┌──────────────────────────────────────────┐ │
│ │                                                             │                 │                                          │ │
│ │             Repo Not Found<br/>or Access Denied             │             ┌───┤   Locate Contract<br/>at contractPath    │ │
│ │                                                             │             │   │                                          │ │
│ └─────────────────────────────────────────────────────────────┘             │   └─────────────────────┬────────────────────┘ │
│                                                                             │                         │                      │
│                                                                             │                         │                      │
│                                ┌─────────────────Not─Found──────────────────┘                       Found                    │
│                                │                                                                      │                      │
│                                ▼                                                                      ▼                      │
│ ┌─────────────────────────────────────────────────────────────┐                 ┌──────────────────────────────────────────┐ │
│ │                                                             │                 │                                          │ │
│ │                 Contract File<br/>Not Found                 │             Fail┤ Compile with Foundry<br/>Verify Bytecode │ │
│ │                                                             │             │   │                                          │ │
│ └─────────────────────────────────────────────────────────────┘             │   └─────────────────────┬────────────────────┘ │
│                                                                             │                         │                      │
│                                                                             │                         │                      │
│                                ┌────────────────────────────────────────────┘                      Success                   │
│                                │                                                                      │                      │
│                                ▼                                                                      ▼                      │
│ ┌─────────────────────────────────────────────────────────────┐                 ┌──────────────────────────────────────────┐ │
│ │                                                             │                 │                                          │ │
│ │                    Compilation<br/>Failed                   │                 │      Initial Security<br/>Analysis       │ │
│ │                                                             │                 │                                          │ │
│ └─────────────────────────────────────────────────────────────┘                 └─────────────────────┬────────────────────┘ │
│                                                                                                       │                      │
│                                                                                                       │                      │
│                                                                                                       │                      │
│                                                                                                       │                      │
│                                                                                                       │                      │
│ ┌─────────────────────────────────────────────────────────────┐                                       │                      │
│ │                                                             │                                       │                      │
│ │                   Calculate Risk<br/>Score                  │     ◄─────────────────────────────────┘                      │
│ │                                                             │                                                              │
│ └──────────────────────────────┬──────────────────────────────┘                                                              │
│                                │                                                                                             │
└────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────┘
                                 │                                                                                              
                                 │                                                                                              
                                 │                                                                                              
┌────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────┐
│                                │             "Blockchain Layer (Base Sepolia)"                                               │
│                                │                                                                                             │
│                                ▼                                                                                             │
│ ┌─────────────────────────────────────────────────────────────┐                                                              │
│ │                                                             │                                                              │
│ │          Call ProtocolRegistry<br/>registerProtocol         │                                                              │
│ │                                                             │                                                              │
│ └──────────────────────────────┬──────────────────────────────┘                                                              │
│                                │                                                                                             │
│                                │                                                                                             │
│                                │                                                                                             │
│                                │                                                                                             │
│                                ▼                                                                                             │
│ ┌─────────────────────────────────────────────────────────────┐                                                              │
│ │                                                             │                                                              │
│ │                  Transaction<br/>Confirmed?                 │    ├◄───────┬─────Fail────────────────┐                      │
│ │                                                             │             │                         │                      │
│ └──────────────────────────────┬──────────────────────────────┘             │                         │                      │
│                             Pending                                         │                         │                      │
│                                │                                            │                         │                      │
│                             Success─────────────────────────────────────────┘                         │                      │
│                                │                                                                      │                      │
│                                ▼                                                                      ▼                      │
│ ┌─────────────────────────────────────────────────────────────┐                 ┌──────────────────────────────────────────┐ │
│ │                                                             │                 │                                          │ │
│ │                     Store in PostgreSQL                     │                 │  Registration Failed<br/>Revert Reason   │ │
│ │                                                             │                 │                                          │ │
│ └──────────────────────────────┬──────────────────────────────┘                 └──────────────────────────────────────────┘ │
│                                │                                                                                             │
└────────────────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────┘
                                 │                                                                                              
                                 │                                                                                              
                                 │                                                                                              
┌────────────────────────────────┼────────────────────────────────┐                                                             
│                    "Storage & Notification"                     │                                                             
│                                │                                │                                                             
│                                ▼                                │                                                             
│ ┌─────────────────────────────────────────────────────────────┐ │                                                             
│ │                                                             │ │                                                             
│ │            Cache Cloned Repo<br/>for Future Scans           │ │                                                             
│ │                                                             │ │                                                             
│ └──────────────────────────────┬──────────────────────────────┘ │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                ▼                                │                                                             
│ ┌─────────────────────────────────────────────────────────────┐ │                                                             
│ │                                                             │ │                                                             
│ │               Index for<br/>Researcher Agents               │ │                                                             
│ │                                                             │ │                                                             
│ └──────────────────────────────┬──────────────────────────────┘ │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                ▼                                │                                                             
│ ┌─────────────────────────────────────────────────────────────┐ │                                                             
│ │                                                             │ │                                                             
│ │        Emit WebSocket<br/>Event: protocol_registered        │ │                                                             
│ │                                                             │ │                                                             
│ └──────────────────────────────┬──────────────────────────────┘ │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                │                                │                                                             
│                                ▼                                │                                                             
│ ┌─────────────────────────────────────────────────────────────┐ │                                                             
│ │                                                             │ │                                                             
│ │             Dashboard Updates<br/>Protocol List             │ │                                                             
│ │                                                             │ │                                                             
│ └──────────────────────────────┬──────────────────────────────┘ │                                                             
│                                │                                │                                                             
└────────────────────────────────┼────────────────────────────────┘                                                             
                                 │                                                                                              
                                 │                                                                                              
                                 ▼                                                                                              
  ┌─────────────────────────────────────────────────────────────┐                                                               
  │                                                             │                                                               
  │              Prompt User:<br/>Fund Bounty Pool              │                                                               
  │                                                             │                                                               
  └──────────────────────────────┬──────────────────────────────┘                                                               
                                 │                                                                                              
                                 │                                                                                              
                                 │                                                                                              
                                 │                                                                                              
                                 ▼                                                                                              
  ┌─────────────────────────────────────────────────────────────┐                                                               
  │                                                             │                                                               
  │                 Continue to<br/>Funding Flow                │                                                               
  │                                                             │                                                               
  └─────────────────────────────────────────────────────────────┘                                                               
```


### Protocol Registration Sequence


```
┌────────────────┐                                                   ┌──────────┐                       ┌─────────────┐            ┌────────────────┐                   ┌────────┐        ┌──────────────┐  ┌────────────┐  ┌────────────┐   
│ Protocol Owner │                                                   │ Frontend │                       │ Backend API │            │ Protocol Agent │                   │ GitHub │        │ Base Sepolia │  │ PostgreSQL │  │ Code Cache │   
└────────┬───────┘                                                   └─────┬────┘                       └──────┬──────┘            └────────┬───────┘                   └────┬───┘        └───────┬──────┘  └──────┬─────┘  └──────┬─────┘   
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │  Fill registration form<br/>(githubUrl, branch, contractPath)   │                                   │                            │                                │                    │                │               │         
         │─────────────────────────────────────────────────────────────────▶                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │        POST /api/protocols        │                            │                                │                    │                │               │         
         │                                                                 │───────────────────────────────────▶                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   ├───┐                        │                                │                    │                │               │         
         │                                                                 │                                   │   │ Validate request (Zod) │                                │                    │                │               │         
         │                                                                 │                                   ◀───┘                        │                                │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │  Queue registration task   │                                │                    │                │               │         
         │                                                                 │                                   │────────────────────────────▶                                │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │  Clone repo at branch/commit   │                    │                │               │         
         │                                                                 │                                   │                            │────────────────────────────────▶                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │      Repository contents       │                    │                │               │         
         │                                                                 │                                   │                            ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            ├───┐                            │                    │                │               │         
         │                                                                 │                                   │                            │   │ Locate contract at contractPath                 │                │               │         
         │                                                                 │                                   │                            ◀───┘                            │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            ├───┐                            │                    │                │               │         
         │                                                                 │                                   │                            │   │ Compile with Foundry       │                    │                │               │         
         │                                                                 │                                   │                            ◀───┘                            │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            ├───┐                            │                    │                │               │         
         │                                                                 │                                   │                            │   │ Analyze & calculate risk score                  │                │               │         
         │                                                                 │                                   │                            ◀───┘                            │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │         registerProtocol(githubUrl, terms)          │                │               │         
         │                                                                 │                                   │                            │─────────────────────────────────────────────────────▶                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                  Transaction hash                   │                │               │         
         │                                                                 │                                   │                            ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                Wait for confirmation                │                │               │         
         │                                                                 │                                   │                            │─────────────────────────────────────────────────────▶                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                  Receipt (success)                  │                │               │         
         │                                                                 │                                   │                            ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                       INSERT protocol record        │                │               │         
         │                                                                 │                                   │                            │──────────────────────────────────────────────────────────────────────▶               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                              Store compiled artifacts                │               │         
         │                                                                 │                                   │                            │──────────────────────────────────────────────────────────────────────────────────────▶         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │   Registration complete    │                                │                    │                │               │         
         │                                                                 │                                   ◀────────────────────────────│                                │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                                                                 │  WebSocket: protocol_registered   │                            │                                │                    │                │               │         
         │                                                                 ◀───────────────────────────────────│                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
         │                   Show success + fund prompt                    │                                   │                            │                                │                    │                │               │         
         ◀─────────────────────────────────────────────────────────────────│                                   │                            │                                │                    │                │               │         
         │                                                                 │                                   │                            │                                │                    │                │               │         
┌────────┴───────┐                                                   ┌─────┴────┐                       ┌──────┴──────┐            ┌────────┴───────┐                   ┌────┴───┐        ┌───────┴──────┐  ┌──────┴─────┐  ┌──────┴─────┐   
│ Protocol Owner │                                                   │ Frontend │                       │ Backend API │            │ Protocol Agent │                   │ GitHub │        │ Base Sepolia │  │ PostgreSQL │  │ Code Cache │   
└────────────────┘                                                   └──────────┘                       └─────────────┘            └────────────────┘                   └────────┘        └──────────────┘  └────────────┘  └────────────┘   
```


---

## 3. Vulnerability Scanning Flow


```
┌──────────────────────────────────────────┐                                                                                                                        
│            "Scan Scheduler"              │                                                                                                                        
│                                          │                                                                                                                        
│                                          │                                                                                                                        
│ ┌──────────────────────────────────────┐ │                                                                                                                        
│ │                                      │ │                                                                                                                        
│ │       Cron Job<br/>Every 5 min       │ │                                                                                                                        
│ │                                      │ │                                                                                                                        
│ └───────────────────┬──────────────────┘ │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     ▼                    │                                                                                                                        
│ ┌──────────────────────────────────────┐ │                                                                                                                        
│ │                                      │ │                                                                                                                        
│ │      Fetch Active<br/>Protocols      │ │                                                                                                                        
│ │                                      │ │                                                                                                                        
│ └───────────────────┬──────────────────┘ │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     ▼                    │                                                                                                                        
│ ┌──────────────────────────────────────┐ │                                                                                                                        
│ │                                      │ │                                                                                                                        
│ │ Sort by Priority<br/>Last Scan Time  │ │                                                                                                                        
│ │                                      │ │                                                                                                                        
│ └───────────────────┬──────────────────┘ │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     │                    │                                                                                                                        
│                     ▼                    │                                                                                                                        
│ ┌──────────────────────────────────────┐ │                                                                                                                        
│ │                                      │ │                                                                                                                        
│ │ Distribute to<br/>Researcher Agents  │ │                                                                                                                        
│ │                                      │ │                                                                                                                        
│ └───────────────────┬──────────────────┘ │                                                                                                                        
│                     │                    │                                                                                                                        
└─────────────────────┼────────────────────┘                                                                                                                        
                      │                                                                                                                                             
                      │                                                                                                                                             
                      │                                                                                                                                             
┌─────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                     │                                        "Researcher Agent - Static Analysis"                                                                │
│                     │                                                                                                                                            │
│                     ▼                                                                                                                                            │
│ ┌──────────────────────────────────────┐                                                                                                                         │
│ │                                      │                                                                                                                         │
│ │ Researcher Agent<br/>Receives Target │                                                                                                                         │
│ │                                      │                                                                                                                         │
│ └───────────────────┬──────────────────┘                                                                                                                         │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     ▼                                                                                                                                            │
│ ┌──────────────────────────────────────┐                                                                                                                         │
│ │                                      │                                                                                                                         │
│ │     Fetch Contract<br/>Bytecode      │                                                                                                                         │
│ │                                      │                                                                                                                         │
│ └───────────────────┬──────────────────┘                                                                                                                         │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     ▼                                                                                                                                            │
│ ┌──────────────────────────────────────┐                                                                                                                         │
│ │                                      │                                                                                                                         │
│ │    Decompile to<br/>Readable Form    │                                                                                                                         │
│ │                                      │                                                                                                                         │
│ └───────────────────┬──────────────────┘                                                                                                                         │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     │                                                                                                                                            │
│                     ▼                                                                                                                                            │
│ ┌──────────────────────────────────────┐                                                                                                                         │
│ │                                      │                                                                                                                         │
│ │   Run Static Analysis<br/>Patterns   ├─────┬────────────────────────┐                                                                                          │
│ │                                      │     │                        │                                                                                          │
│ └───────────────────┬──────────────────┘     └────────────────────────┼─────────────────────────────────────────┬────────────────────────────────┐               │
│                     │                                                 │                                         │                                │               │
│                     │                                                 │                                         │                                │               │
│                     │                                                 │                                         │                                │               │
│                     │                                                 │                                         │                                │               │
│                     ▼                                                 ▼                                         ▼                                ▼               │
│ ┌──────────────────────────────────────┐     ┌────────────────────────────────────────────────┐     ┌───────────────────────┐     ┌────────────────────────────┐ │
│ │                                      │     │                                                │     │                       │     │                            │ │
│ │          Check: Reentrancy           │     │                Check: Overflow                 │     │ Check: Access Control │     │ Check: Oracle Manipulation │ │
│ │                                      │     │                                                │     │                       │     │                            │ │
│ └───────────────────┬──────────────────┘     └────────────────────────┬───────────────────────┘     └───────────┬───────────┘     └──────────────┬─────────────┘ │
│                     │                                                 │                                         │                                │               │
└─────────────────────┼─────────────────────────────────────────────────┼─────────────────────────────────────────┼────────────────────────────────┼───────────────┘
                      │                                                 │                                         │                                │                
                      │                                                 │                                         │                                │                
                      │                                                 │                                         │                                │                
┌─────────────────────┼─────────────────────────────────────────────────┼─────────────────────────┐               │                                │                
│                     │              "Vulnerability Detection"          │                         │               │                                │                
│                     │                                                 │                         │               │                                │                
│                     ▼                                                 │                         │               │                                │                
│ ┌──────────────────────────────────────┐                              │                         │               │                                │                
│ │                                      │                              │                         │               │                                │                
│ │      Vulnerabilities<br/>Found?      ├◄────────────Yes──────────────┼─────────────────────────┼───────────────┴────────────────────────────────┘                
│ │                                      │                              │                         │                                                                 
│ └───────────────────┬──────────────────┘                              │                         │                                                                 
│                     │                                                 │                         │                                                                 
│                     │                                                 │                         │                                                                 
│                    No                                                 │                         │                                                                 
│                     │                                                 │                         │                                                                 
│                     ▼                                                 ▼                         │                                                                 
│ ┌──────────────────────────────────────┐     ┌────────────────────────────────────────────────┐ │                                                                 
│ │                                      │     │                                                │ │                                                                 
│ │ Log: Clean Scan<br/>Update Timestamp │     │ Classify Severity<br/>Critical/High/Medium/Low │ │                                                                 
│ │                                      │     │                                                │ │                                                                 
│ └───────────────────┬──────────────────┘     └────────────────────────┬───────────────────────┘ │                                                                 
│                     │                                                 │                         │                                                                 
└─────────────────────┼─────────────────────────────────────────────────┼─────────────────────────┘                                                                 
                      │                                                 │                                                                                           
                      │                                                 │                                                                                           
                      │                                                 │                                                                                           
┌─────────────────────┼─────────────────────────────────────────────────┼─────────────────────────┐                                                                 
│                     │                 "Proof Generation"              │                         │                                                                 
│                     │                                                 │                         │                                                                 
│                     ▼                                                 ▼                         │                                                                 
│ ┌──────────────────────────────────────┐     ┌────────────────────────────────────────────────┐ │                                                                 
│ │                                      │     │                                                │ │                                                                 
│ │    Update Last Scan<br/>Timestamp    │     │     Generate Exploit<br/>Proof-of-Concept      │ │                                                                 
│ │                                      │     │                                                │ │                                                                 
│ └──────────────────────────────────────┘     └────────────────────────┬───────────────────────┘ │                                                                 
│                                                                       │                         │                                                                 
│                                                                       │                         │                                                                 
│                                                                       │                         │                                                                 
│                                                                       │                         │                                                                 
│                                                                       │                         │                                                                 
│ ┌──────────────────────────────────────┐                              │                         │                                                                 
│ │                                      │                              │                         │                                                                 
│ │      Document Exploit<br/>Steps      │◄─────────────────────────────┘                         │                                                                 
│ │                                      │                                                        │                                                                 
│ └───────────────────┬──────────────────┘                                                        │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     ▼                                                                           │                                                                 
│ ┌──────────────────────────────────────┐                                                        │                                                                 
│ │                                      │                                                        │                                                                 
│ │      Encrypt Proof<br/>Payload       │                                                        │                                                                 
│ │                                      │                                                        │                                                                 
│ └───────────────────┬──────────────────┘                                                        │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     ▼                                                                           │                                                                 
│ ┌──────────────────────────────────────┐                                                        │                                                                 
│ │                                      │                                                        │                                                                 
│ │      Store in IPFS<br/>Get CID       │                                                        │                                                                 
│ │                                      │                                                        │                                                                 
│ └───────────────────┬──────────────────┘                                                        │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     │                                                                           │                                                                 
│                     ▼                                                                           │                                                                 
│ ┌──────────────────────────────────────┐                                                        │                                                                 
│ │                                      │                                                        │                                                                 
│ │    Submit to<br/>Validator Agent     │                                                        │                                                                 
│ │                                      │                                                        │                                                                 
│ └───────────────────┬──────────────────┘                                                        │                                                                 
│                     │                                                                           │                                                                 
└─────────────────────┼───────────────────────────────────────────────────────────────────────────┘                                                                 
                      │                                                                                                                                             
                      │                                                                                                                                             
                      ▼                                                                                                                                             
  ┌──────────────────────────────────────┐                                                                                                                          
  │                                      │                                                                                                                          
  │  Log Finding<br/>Pending Validation  │                                                                                                                          
  │                                      │                                                                                                                          
  └──────────────────────────────────────┘                                                                                                                          
```


### Vulnerability Detection Patterns


```
┌─────────────────────────────────────────────────┬───────────────────────────────────────┐  
│                "Detection Rules"  "Bounty Multiplier"                                   │  
│                                                 │                                       │  
│                                                 │                                       │  
│ ┌─────────────────────────────────────────────┐ │    ┌────────────┐      ┌────────────┐ │  
│ │                                             │ │    │            │      │            │ │  
│ │   Reentrancy<br/>call before state update   ├─┼─┬─►│  Critical  ├2.0x─►│ Base * 2.0 │ │  
│ │                                             │ │ │  │            │      │            │ │  
│ └─────────────────────────────────────────────┘ │ │  └────────────┘      └────────────┘ │  
│                                                 │ │                                     │  
│                                                 │ │                                     │  
│                                                 │ │                                     │  
│                                                 │ │                                     │  
│                                                 │ │                                     │  
│ ┌─────────────────────────────────────────────┐ │ │  ┌────────────┐      ┌────────────┐ │  
│ │                                             │ │ │  │            │      │            │ │  
│ │ Integer Overflow<br/>unchecked math pre-0.8 ├─┼─┼─►│    High    ├1.5x─►│ Base * 1.5 │ │  
│ │                                             │ │ │  │            │      │            │ │  
│ └─────────────────────────────────────────────┘ │ │  └────────────┘      └────────────┘ │  
│                                                 │ │                                     │  
│                                                 │ │                                     │  
│                        ┌────────────────────────┼─┤                                     │  
│                        │                        │ │                                     │  
│                        │                        │ │                                     │  
│ ┌──────────────────────┴──────────────────────┐ │ │  ┌────────────┐                     │  
│ │                                             │ │ │  │            │                     │  
│ │     Access Control<br/>missing onlyOwner    │ │ ├─►│ Base * 1.0 │                     │  
│ │                                             │ │ │  │            │                     │  
│ └─────────────────────────────────────────────┘ │ │  └────────────┘                     │  
│                                                 │ │                                     │  
│                                                 │ │                                     │  
│                        ┌────────────────────────┼─┤                                     │  
│                        │                        │ │                                     │  
│                        │                        │ │                                     │  
│ ┌──────────────────────┴──────────────────────┐ │ │  ┌────────────┐                     │  
│ │                                             │ │ │  │            │                     │  
│ │  Oracle Manipulation<br/>single-block price │ │ │  │ Base * 0.5 │                     │  
│ │                                             │ │ │  │            │                     │  
│ └─────────────────────────────────────────────┘ │ │  └────────────┘                     │  
│                                                 │ │         ▲                           │  
│                                                 │ │         │                           │  
│                        ┌────────────────────────┼─┤         │                           │  
│                        │                        │ │         │                           │  
│                        │                        │ │         │                           │  
│ ┌──────────────────────┴──────────────────────┐ │ │         │                           │  
│ │                                             │ │ │         │                           │  
│ │        Flash Loan<br/>unsafe callback       │ │ │         │                           │  
│ │                                             │ │ │         │                           │  
│ └─────────────────────────────────────────────┘ │ │         │                           │  
│                                                 │ │         │                           │  
├─────────────────────────────────────────────────┘ │         │                           │  
│                        ┌──────────────────────────┘         │                           │  
│                      1.0x                                   │                           │  
│                        │                                    │                           │  
│ ┌──────────────────────┴──────────────────────┐             │                           │  
│ │                                             │             │                           │  
│ │                    Medium                   │             │                           │  
│ │                                             │             │                           │  
│ └─────────────────────────────────────────────┘             │                           │  
│                                                             │                           │  
│                                                             │                           │  
│                                                             │                           │  
│                                                             │                           │  
│                                                             │                           │  
│ ┌─────────────────────────────────────────────┐             │                           │  
│ │                                             │             │                           │  
│ │                     Low                     ├────0.5x─────┘                           │  
│ │                                             │                                         │  
│ └─────────────────────────────────────────────┘                                         │  
│                                                                                         │  
└─────────────────────────────────────────────────────────────────────────────────────────┘  
```


---

## 4. Exploit Validation Flow

**Cross-Chain Validation:** Execute on Local Anvil → Record on Base Sepolia


```
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                       "Validator Agent Receives Proof"                                         │
│                                                                                                                │
│                                                                                                                │
│ ┌───────────────────────────────────────────────────┐                                                          │
│ │                                                   │                                                          │
│ │        Receive Encrypted<br/>Proof from RA        │                                                          │
│ │                                                   │                                                          │
│ └─────────────────────────┬─────────────────────────┘                                                          │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           ▼                                                                                    │
│ ┌───────────────────────────────────────────────────┐                                                          │
│ │                                                   │                                                          │
│ │             Decrypt Proof<br/>Payload             │                                                          │
│ │                                                   │                                                          │
│ └─────────────────────────┬─────────────────────────┘                                                          │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           ▼                                                                                    │
│ ┌───────────────────────────────────────────────────┐                                                          │
│ │                                                   │                                                          │
│ │           Parse Exploit<br/>Instructions          │                                                          │
│ │                                                   │                                                          │
│ └─────────────────────────┬─────────────────────────┘                                                          │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           ▼                                                                                    │
│ ┌───────────────────────────────────────────────────┐                                                          │
│ │                                                   │                                                          │
│ │              Valid Proof<br/>Format?              ├──────────────Yes──────────────┐                          │
│ │                                                   │                               │                          │
│ └─────────────────────────┬─────────────────────────┘                               │                          │
│                           │                                                         │                          │
│                           │                                                         │                          │
│                          No                                                         │                          │
│                           │                                                         │                          │
│                           ▼                                                         ▼                          │
│ ┌───────────────────────────────────────────────────┐     ┌──────────────────────────────────────────────────┐ │
│ │                                                   │     │                                                  │ │
│ │        Reject: Invalid Format<br/>Notify RA       │     │         Prepare Sandbox<br/>Environment          │ │
│ │                                                   │     │                                                  │ │
│ └───────────────────────────────────────────────────┘     └─────────────────────────┬────────────────────────┘ │
│                                                                                     │                          │
└─────────────────────────────────────────────────────────────────────────────────────┼──────────────────────────┘
                                                                                      │                           
                                                                                      │                           
                                                                                      │                           
┌───────────────────────────────────────────────────────┐                             │                           
│          "LOCAL ANVIL - Sandbox (Port 8546)"          │                             │                           
│                                                       │                             │                           
│                                                       │                             │                           
│ ┌───────────────────────────────────────────────────┐ │                             │                           
│ │                                                   │ │                             │                           
│ │    Spawn Sandbox Anvil<br/>Fork from Port 8545    │◄┼─────────────────────────────┘                           
│ │                                                   │ │                                                         
│ └─────────────────────────┬─────────────────────────┘ │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           ▼                           │                                                         
│ ┌───────────────────────────────────────────────────┐ │                                                         
│ │                                                   │ │                                                         
│ │   Copy Target Contract<br/>State from Main Anvil  │ │                                                         
│ │                                                   │ │                                                         
│ └─────────────────────────┬─────────────────────────┘ │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           ▼                           │                                                         
│ ┌───────────────────────────────────────────────────┐ │                                                         
│ │                                                   │ │                                                         
│ │         Setup Required<br/>State Variables        │ │                                                         
│ │                                                   │ │                                                         
│ └─────────────────────────┬─────────────────────────┘ │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           ▼                           │                                                         
│ ┌───────────────────────────────────────────────────┐ │                                                         
│ │                                                   │ │                                                         
│ │            Deploy Exploit<br/>Contract            │ │                                                         
│ │                                                   │ │                                                         
│ └─────────────────────────┬─────────────────────────┘ │                                                         
│                           │                           │                                                         
└───────────────────────────┼───────────────────────────┘                                                         
                            │                                                                                     
                            │                                                                                     
                            │                                                                                     
┌───────────────────────────┼────────────────────────────────────────────────────────────────────────────────────┐
│                           │           "LOCAL ANVIL - Exploit Execution"                                        │
│                           │                                                                                    │
│                           ▼                                                                                    │
│ ┌───────────────────────────────────────────────────┐                                                          │
│ │                                                   │                                                          │
│ │          Execute Exploit<br/>Transaction          │                                                          │
│ │                                                   │                                                          │
│ └─────────────────────────┬─────────────────────────┘                                                          │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           ▼                                                                                    │
│ ┌───────────────────────────────────────────────────┐                                                          │
│ │                                                   │                                                          │
│ │             Capture State<br/>Changes             │                                                          │
│ │                                                   │                                                          │
│ └─────────────────────────┬─────────────────────────┘                                                          │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           │                                                                                    │
│                           ▼                                                                                    │
│ ┌───────────────────────────────────────────────────┐                                                          │
│ │                                                   │                                                          │
│ │              Exploit<br/>Successful?              ├──────────────Yes──────────────┐                          │
│ │                                                   │                               │                          │
│ └─────────────────────────┬─────────────────────────┘                               │                          │
│                           │                                                         │                          │
│                           │                                                         │                          │
│                          No                                                         │                          │
│                           │                                                         │                          │
│                           ▼                                                         ▼                          │
│ ┌───────────────────────────────────────────────────┐     ┌──────────────────────────────────────────────────┐ │
│ │                                                   │     │                                                  │ │
│ │          Record: FALSE<br/>Exploit Failed         │     │     Record: TRUE<br/>Vulnerability Confirmed     │ │
│ │                                                   │     │                                                  │ │
│ └─────────────────────────┬─────────────────────────┘     └─────────────────────────┬────────────────────────┘ │
│                           │                                                         │                          │
└───────────────────────────┼─────────────────────────────────────────────────────────┼──────────────────────────┘
                            │                                                         │                           
                            │                                                         │                           
                            │                                                         │                           
┌───────────────────────────┼─────────────────────────────────────────────────────────┼──────────────────────────┐
│                           │           "BASE SEPOLIA - Registry Update"              │                          │
│                           │                                                         │                          │
│                           ▼                                                         ▼                          │
│ ┌───────────────────────────────────────────────────┐     ┌──────────────────────────────────────────────────┐ │
│ │                                                   │     │                                                  │ │
│ │ Update ERC-8004<br/>on Sepolia<br/>Status = FALSE │     │ Update ERC-8004<br/>on Sepolia<br/>Status = TRUE │ │
│ │                                                   │     │                                                  │ │
│ └─────────────────────────┬─────────────────────────┘     └─────────────────────────┬────────────────────────┘ │
│                           │                                                         │                          │
│                           │                                                         │                          │
│                           │                                                         │                          │
│                           │                                                         │                          │
│                           ▼                                                         ▼                          │
│ ┌───────────────────────────────────────────────────┐     ┌──────────────────────────────────────────────────┐ │
│ │                                                   │     │                                                  │ │
│ │          Notify RA:<br/>Validation Failed         │     │     Trigger x402 Payment<br/>on Base Sepolia     │ │
│ │                                                   │     │                                                  │ │
│ └─────────────────────────┬─────────────────────────┘     └─────────────────────────┬────────────────────────┘ │
│                           │                                                         │                          │
└───────────────────────────┼─────────────────────────────────────────────────────────┼──────────────────────────┘
                            │                                                         │                           
                            │                                                         │                           
                            │                                                         │                           
┌───────────────────────────┼───────────────────────────┐                             │                           
│                       "Cleanup"                       │                             │                           
│                           │                           │                             │                           
│                           ▼                           │                             │                           
│ ┌───────────────────────────────────────────────────┐ │                             │                           
│ │                                                   │ │                             │                           
│ │        Destroy Sandbox<br/>Clean Resources        │◄┼─────────────────────────────┘                           
│ │                                                   │ │                                                         
│ └─────────────────────────┬─────────────────────────┘ │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           │                           │                                                         
│                           ▼                           │                                                         
│ ┌───────────────────────────────────────────────────┐ │                                                         
│ │                                                   │ │                                                         
│ │           Ready for Next<br/>Validation           │ │                                                         
│ │                                                   │ │                                                         
│ └───────────────────────────────────────────────────┘ │                                                         
│                                                       │                                                         
└───────────────────────────────────────────────────────┘                                                         
```


### Sandbox Isolation (Local Anvil)


```
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                     "LOCAL ANVIL - Sandbox (Port 8546)"                                                                                                      │
│                                                                                                                                                                                                                                              │
│                                                                                                                                                                                                                                              │
│ ┌───────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐ │
│ │                                                 "Forked State"                                                  │                       "Exploit Execution"                                                                              │ │
│ │                                                           │                                                     │                                                                                                                        │ │
│ │                                                           │                                                     │                                                                                                                        │ │
│ │ ┌────────────────────────────────────────────┐            │ ┌─────────────────────────────────────────────────┐ │                        ┌───────────────────────────────────────────────┐         ┌───────────────────────────────────┐ │ │
│ │ │                                            │            │ │                                                 │ │                        │                                               │         │                                   │ │ │
│ │ │              Backend Service               ├◄─┐         │ │          Anvil Sandbox<br/>Chain 31338          │ │                        │            Target Contract<br/>Copy├◄────3.─Attack──────┤          Exploit Contract         │ │ │
│ │ │                                            │  │         │ │                                                 │ │                        │                                          │    │         │                                   │ │ │
│ │ └──────────────────────┬─────────────────────┘  │         │ └─────────────────────────────────────────────────┘ │                        └──────────────────────────────────────────┼────┘         └───────────────────────────────────┘ │ │
│ │                        │                        │         │                                                     │                                                                   │                                ▲                   │ │
│ │                        │                        │         │                                                     │                                                                   │                                │                   │ │
│ │                        │                        │         │                                                     │                                                                   │                                │                   │ │
│ │                        │                        │         │                                                     │                                                                   │                                │                   │ │
│ │                  1. Fork state                  └─────────2.─Deploy─exploit──────────┬─────────6.─Update─registry───────5.─Report─TRUE/FALSE─────────────────────┬──────────────────┴───────4.─State─changes─────────┤                   │ │
│ ├────────────────────────┼───────────────────────┐          │                          │                          │          │                                     │                                                   │                   │ │
│ │              "Target Contracts"                │          │                          │                          │          │                                     │                                                   │                   │ │
│ │                        │                       │          │                          │                          │          │                                     │                                                   │                   │ │
│ │                        ▼                       │          │                          ▼                          │          │                                     ▼                                                   ▼                   │ │
│ │ ┌────────────────────────────────────────────┐ │          │ ┌─────────────────────────────────────────────────┐ │          │             ┌───────────────────────────────────────────────┐         ┌─────────────────┴─────────────────┐ │ │
│ │ │                                            │ │          │ │                                                 │ │          │             │                                               │         │                                   │ │ │
│ │ │ VulnerableVault<br/>MockDeFi<br/>TestToken │ │          │ │              Forge Test<br/>Runner              │├┼──────────┘             │               ERC-8004 Registry               │         │          Execution Result         │ │ │
│ │ │                                            │ │          │ │                                                 │ │                        │                                               │         │                                   │ │ │
│ │ └──────────────────────┬─────────────────────┘ │          │ └─────────────────────────────────────────────────┘ │                        └───────────────────────┬───────────────────────┘         └───────────────────────────────────┘ │ │
│ │                        │                       │          │                                                     │                                                │                                                                       │ │
│ ├────────────────────────┼───────────────────────┘          └─────────────────────────────────────────────────────┼────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────┘ │
│ │                      Copy                                                                                       │                                                │                                                                         │
│ │                        │                                                                                        │                                       7. Trigger payment                                                                 │
│ │                        ▼                                                                                        │                                                │                                                                         │
│ │ ┌────────────────────────────────────────────┐              ┌─────────────────────────────────────────────────┐ │                                                │                                                                         │
│ │ │                                            │              │                                                 │ │                                                │                                                                         │
│ │ │       State Fork<br/>from Main Anvil       │              │                    BountyPool                   │ ◄────────────────────────────────────────────────┘                                                                         │
│ │ │                                            │              │                                                 │ │                                                                                                                          │
│ │ └────────────────────────────────────────────┘              └─────────────────────────────────────────────────┘ │                                                                                                                          │
│ │                                                                                                                 │                                                                                                                          │
│ └─────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘                                                                                                                          │
│                                                                                                                                                                                                                                              │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                
```


---

## 5. Bounty Payment Flow

**All payments occur on Base Sepolia (Chain 84532) using testnet USDC**


```
┌─────────────────────────────────────────────────────────┐                                                                                                                         
│            "BASE SEPOLIA - Payment Trigger"             │                                                                                                                         
│                                                         │                                                                                                                         
│                                                         │                                                                                                                         
│ ┌─────────────────────────────────────────────────────┐ │                                                                                                                         
│ │                                                     │ │                                                                                                                         
│ │ ERC-8004 Registry<br/>Status = TRUE<br/>Chain 84532 │ │                                                                                                                         
│ │                                                     │ │                                                                                                                         
│ └──────────────────────────┬──────────────────────────┘ │                                                                                                                         
│                            │                            │                                                                                                                         
│                            │                            │                                                                                                                         
│                            │                            │                                                                                                                         
│                            │                            │                                                                                                                         
│                            ▼                            │                                                                                                                         
│ ┌─────────────────────────────────────────────────────┐ │                                                                                                                         
│ │                                                     │ │                                                                                                                         
│ │    Emit ValidationConfirmed<br/>Event on Sepolia    │ │                                                                                                                         
│ │                                                     │ │                                                                                                                         
│ └──────────────────────────┬──────────────────────────┘ │                                                                                                                         
│                            │                            │                                                                                                                         
│                            │                            │                                                                                                                         
│                            │                            │                                                                                                                         
│                            │                            │                                                                                                                         
│                            ▼                            │                                                                                                                         
│ ┌─────────────────────────────────────────────────────┐ │                                                                                                                         
│ │                                                     │ │                                                                                                                         
│ │      BountyPool Contract<br/>Listens for Event      │ │                                                                                                                         
│ │                                                     │ │                                                                                                                         
│ └──────────────────────────┬──────────────────────────┘ │                                                                                                                         
│                            │                            │                                                                                                                         
└────────────────────────────┼────────────────────────────┘                                                                                                                         
                             │                                                                                                                                                      
                             │                                                                                                                                                      
                             │                                                                                                                                                      
┌────────────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────────────────┐                                             
│                            │                   "BASE SEPOLIA - Payment Calculation"                                                 │                                             
│                            │                                                                                                        │                                             
│                            ▼                                                                                                        │                                             
│ ┌─────────────────────────────────────────────────────┐                                                                             │                                             
│ │                                                     │                                                                             │                                             
│ │             Fetch Validation<br/>Details            │                                                                             │                                             
│ │                                                     │                                                                             │                                             
│ └──────────────────────────┬──────────────────────────┘                                                                             │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            ▼                                                                                                        │                                             
│ ┌─────────────────────────────────────────────────────┐                                                                             │                                             
│ │                                                     │                                                                             │                                             
│ │            Get Vulnerability<br/>Severity           │                                                                             │                                             
│ │                                                     │                                                                             │                                             
│ └──────────────────────────┬──────────────────────────┘                                                                             │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            ▼                                                                                                        │                                             
│ ┌─────────────────────────────────────────────────────┐                                                                             │                                             
│ │                                                     │                                                                             │                                             
│ │        Calculate Bounty<br/>Base * Multiplier       │                                                                             │                                             
│ │                                                     │                                                                             │                                             
│ └──────────────────────────┬──────────────────────────┘                                                                             │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            │                                                                                                        │                                             
│                            ▼                                                                                                        │                                             
│ ┌─────────────────────────────────────────────────────┐                                                                             │                                             
│ │                                                     │                                                                             │                                             
│ │            Pool Has<br/>Sufficient USDC?            │   ├───────────────────Yes────────────────────┐                              │                                             
│ │                                                     │                                              │                              │                                             
│ └──────────────────────────┬──────────────────────────┘                                              │                              │                                             
│                            │                                                                         │                              │                                             
│                            │                                                                         │                              │                                             
│                           No                                                                         │                              │                                             
│                            │                                                                         │                              │                                             
│                            ▼                                                                         ▼                              │                                             
│ ┌─────────────────────────────────────────────────────┐                ┌──────────────────────────────────────────────────────────┐ │                                             
│ │                                                     │                │                                                          │ │                                             
│ │       Queue Payment<br/>Notify Protocol Owner       │                │              Execute x402<br/>USDC Transfer              │◄┼───────────────────────┐                     
│ │                                                     │                │                                                          │ │                       │                     
│ └──────────────────────────┬──────────────────────────┘                └─────────────────────────────┬────────────────────────────┘ │                       │                     
│                            │                                                                         ▲                              │                       │                     
└────────────────────────────┼─────────────────────────────────────────────────────────────────────────┼──────────────────────────────┘                       │                     
                             │                                                                         │                                                      │                     
                             │                                                                         │                                                      │                     
                             │                                      ┌──────────────────────────────────┤                                                      │                     
┌────────────────────────────┼──────────────────────────────────────┼──────────────────────────────────┼──────────────────────────────────────────────────────┼────────────────────┐
│                            │                                      │     "BASE SEPOLIA - USDC Transfer"                                                      │                    │
│                            │                                      │                                  │                                                      │                    │
│                            ▼                                      │                                  ▼                                                      │                    │
│ ┌─────────────────────────────────────────────────────┐           │    ┌──────────────────────────────────────────────────────────┐                         │                    │
│ │                                                     │           │    │                                                          │                         │                    │
│ │             Monitor Pool<br/>for Funding            │   ├Funded─┘    │ Transfer USDC<br/>0x036CbD53...<br/>to Researcher Wallet │                         │                    │
│ │                                                     │                │                                                          │                         │                    │
│ └─────────────────────────────────────────────────────┘                └─────────────────────────────┬────────────────────────────┘                         │                    │
│                                                                                                      │                                                      │                    │
│                                                                                                      │                                                      │                    │
│                                                                                                      │                                                      │                    │
│                                                                                                      │                                                      │                    │
│                                                                                                      │                                                      │                    │
│ ┌─────────────────────────────────────────────────────┐                                              │                                                      │                    │
│ │                                                     │                                              │                                                      │                    │
│ │              Transaction<br/>Confirmed?             │   ├◄──Fail─────┬────Success──────────────────┤                                                      │                    │
│ │                                                     │                │                             │                                                      │                    │
│ └──────────────────────────┬──────────────────────────┘                └─────────────────────────────┼──────────────────────────────────────────────────────┤                    │
│                            ▲                                                                         │                                                      │                    │
│                            │                                                                         │                                                      │                    │
│                         Pending                                                                      │                                                      │                    │
│                            │                                                                         │                                                      │                    │
│                            ▼                                                                         ▼                                                      ▼                    │
│ ┌──────────────────────────┴──────────────────────────┐                ┌──────────────────────────────────────────────────────────┐     ┌───────────────────┴──────────────────┐ │
│ │                                                     │                │                                                          │     │                                      │ │
│ │           Wait for<br/>Block Confirmation           │                │              Emit PaymentReleased<br/>Event              │     │     Retry Payment<br/>Log Error      │ │
│ │                                                     │                │                                                          │     │                                      │ │
│ └─────────────────────────────────────────────────────┘                └─────────────────────────────┬────────────────────────────┘     └──────────────────────────────────────┘ │
│                                                                                                      │                                                                           │
└──────────────────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────┘
                                                                                                       │                                                                            
                                                                                                       │                                                                            
                                                                                                       │                                                                            
┌──────────────────────────────────────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────┐
│                                                                            "Backend - Post-Payment"  │                                                                           │
│                                                                                                      │                                                                           │
│                                                                                                      │                                                                           │
│ ┌─────────────────────────────────────────────────────┐                                              │                                                                           │
│ │                                                     │                                              │                                                                           │
│ │          Update Database<br/>Payment Record         │    ◄─────────────────────────────────────────┘                                                                           │
│ │                                                     │                                                                                                                          │
│ └──────────────────────────┬──────────────────────────┘                                                                                                                          │
│                            │                                                                                                                                                     │
│                            │                                                                                                                                                     │
│                            │                                                                                                                                                     │
│                            │                                                                                                                                                     │
│                            ▼                                                                                                                                                     │
│ ┌─────────────────────────────────────────────────────┐                                                                                                                          │
│ │                                                     │                                                                                                                          │
│ │                  Notify All Parties                 │   ├────────────┬─────────────────────────────┐                                                                           │
│ │                                                     │                │                             │                                                                           │
│ └──────────────────────────┬──────────────────────────┘                └─────────────────────────────┼──────────────────────────────────────────────────────┐                    │
│                            │                                                                         │                                                      │                    │
│                            │                                                                         │                                                      │                    │
│                            │                                                                         │                                                      │                    │
│                            │                                                                         │                                                      │                    │
│                            ▼                                                                         ▼                                                      ▼                    │
│ ┌─────────────────────────────────────────────────────┐                ┌──────────────────────────────────────────────────────────┐     ┌──────────────────────────────────────┐ │
│ │                                                     │                │                                                          │     │                                      │ │
│ │        Notify Researcher<br/>Payment Received       │                │       Notify Protocol<br/>Vulnerability + Payment        │     │ Update Dashboard<br/>WebSocket Event │ │
│ │                                                     │                │                                                          │     │                                      │ │
│ └─────────────────────────────────────────────────────┘                └──────────────────────────────────────────────────────────┘     └──────────────────────────────────────┘ │
│                                                                                                                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


### Payment Sequence Diagram (Base Sepolia)


```
 ┌─────────────────┐  ┌──────────────────────────────────┐   ┌───────────────────────────────────────┐   ┌───────────────────────────────┐     ┌───────────────────────────────┐   ┌───────────────────┐  ┌──────────┐   ┌───────────┐                       
 │ Validator Agent │  │ Local Anvil<br/>(Exploit Result) │   │ ValidationRegistry<br/>(Base Sepolia) │   │ BountyPool<br/>(Base Sepolia) │     │ USDC Token<br/>(Base Sepolia) │   │ Researcher Wallet │  │ Database │   │ WebSocket │                       
 └────────┬────────┘  └─────────────────┬────────────────┘   └───────────────────┬───────────────────┘   └───────────────┬───────────────┘     └───────────────┬───────────────┘   └─────────┬─────────┘  └─────┬────┘   └─────┬─────┘                       
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │    Exploit result: TRUE     │                                        │                                       │                                     │                             │                  │              │                             
          ◀─────────────────────────────│                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                 ┌─────────────────────────────────────────┐                 │                             │                  │              │                             
          │                             │                                        │                 │ All payment ops on Base Sepolia (84532) │                 │                             │                  │              │                             
          │                             │                                        │                 └─────────────────────────────────────────┘                 │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                  recordResult(validationId, TRUE)                    │                                       │                                     │                             │                  │              │                             
          │──────────────────────────────────────────────────────────────────────▶                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        ├───┐                                   │                                     │                             │                  │              │                             
          │                             │                                        │   │ Store validation result           │                                     │                             │                  │              │                             
          │                             │                                        ◀───┘                                   │                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │    Emit ValidationConfirmed event     │                                     │                             │                  │              │                             
          │                             │                                        │╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌▶                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │    getValidationDetails(proofHash)    │                                     │                             │                  │              │                             
          │                             │                                        ◀───────────────────────────────────────│                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │      Return severity, researcher      │                                     │                             │                  │              │                             
          │                             │                                        │╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌▶                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       ├───┐                                 │                             │                  │              │                             
          │                             │                                        │                                       │   │ Calculate bounty amount         │                             │                  │              │                             
          │                             │                                        │                                       ◀───┘                                 │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       │        balanceOf(bountyPool)        │                             │                  │              │                             
          │                             │                                        │                                       │─────────────────────────────────────▶                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       │           Return balance            │                             │                  │              │                             
          │                             │                                        │                                       ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
      ┌alt [Sufficient Balance]──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐              │              │                             
      │   │                             │                                        │                                       │                                     │                             │   │              │              │                             
      │   │                             │                                        │                                       │  safeTransfer(researcher, amount)   │                             │   │              │              │                             
      │   │                             │                                        │                                       │─────────────────────────────────────▶                             │   │              │              │                             
      │   │                             │                                        │                                       │                                     │                             │   │              │              │                             
      │   │                             │                                        │                                       │                                     │    Credit USDC (Sepolia)    │   │              │              │                             
      │   │                             │                                        │                                       │                                     │─────────────────────────────▶   │              │              │                             
      │   │                             │                                        │                                       │                                     │                             │   │              │              │                             
      │   │                             │                                        │                                       │          Transfer success           │                             │   │              │              │                             
      │   │                             │                                        │                                       ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                             │   │              │              │                             
      │   │                             │                                        │                                       │                                     │                             │   │              │              │                             
      │   │                             │                                        │                                       ├───┐                                 │                             │   │              │              │                             
      │   │                             │                                        │                                       │   │ Emit PaymentReleased            │                             │   │              │              │                             
      │   │                             │                                        │                                       ◀───┘                                 │                             │   │              │              │                             
      │   │                             │                                        │                                       │                                     │                             │   │              │              │                             
      ├[Insufficient Balance]╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌┤              │              │                             
      │   │                             │                                        │                                       │                                     │                             │   │              │              │                             
      │   │                             │                                        │                                       ├───┐                                 │                             │   │              │              │                             
      │   │                             │                                        │                                       │   │ Queue payment                   │                             │   │              │              │                             
      │   │                             │                                        │                                       ◀───┘                                 │                             │   │              │              │                             
      │   │                             │                                        │                                       │                                     │                             │   │              │              │                             
      │   │                             │            Insufficient funds error    │                                       │                                     │                             │   │              │              │                             
      │   ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│                                     │                             │   │              │              │                             
      │   │                             │                                        │                                       │                                     │                             │   │              │              │                             
      └──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘              │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                   Record payment                  │                  │              │                             
          │                             │                                        │                                       │──────────────────────────────────────────────────────────────────────────────────────▶              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │Confirmed                    │                  │              │                             
          │                             │                                        │                                       ◀╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌│              │                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │  Emit payment_released      │                  │              │                             
          │                             │                                        │                                       │─────────────────────────────────────────────────────────────────────────────────────────────────────▶                             
          │                             │                                        │                                       │                                     │                             │                  │              │                             
          │                             │                                        │                                       │                                     │                             │                  │              ├╌╌╌┐                         
          │                             │                                        │                                       │                                     │                             │                  │              │   │ Broadcast to clients    
          │                             │                                        │                                       │                                     │                             │                  │              ◀╌╌╌┘                         
          │                             │                                        │                                       │                                     │                             │                  │              │                             
 ┌────────┴────────┐  ┌─────────────────┴────────────────┐   ┌───────────────────┴───────────────────┐   ┌───────────────┴───────────────┐     ┌───────────────┴───────────────┐   ┌─────────┴─────────┐  ┌─────┴────┐   ┌─────┴─────┐                       
 │ Validator Agent │  │ Local Anvil<br/>(Exploit Result) │   │ ValidationRegistry<br/>(Base Sepolia) │   │ BountyPool<br/>(Base Sepolia) │     │ USDC Token<br/>(Base Sepolia) │   │ Researcher Wallet │  │ Database │   │ WebSocket │                       
 └─────────────────┘  └──────────────────────────────────┘   └───────────────────────────────────────┘   └───────────────────────────────┘     └───────────────────────────────┘   └───────────────────┘  └──────────┘   └───────────┘                       
```


---

## 6. Agent-to-Agent Communication


```
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────┐ ┌──────────────────────────────────────────────────────────────────────────────────────────────────┬─────────────────────────────────────────────────────────────┐
│                                                                                   "Message Types"  "Communication Bus"                                                               │                                     │ │                                       "Message Structure"             "Security Layer"           │                                                             │
│                                                                                                                                                                                      │                                     │ │                                                                                                  │                                                             │
│                                                                                                                                                                                      │                                     │ │                                                                                                  │                                                             │
│ ┌──────────────────────────┐     ┌──────────────────────────────┐          ┌─────────────────────────────────────────┐               ┌─────────────────────────────────────────────┐┌┼───────────────────────────────────┐ │ │ ┌─────┐     ┌──────┐     ┌──────┐     ┌────┐     ┌─────────┐     ┌───────────┐     ┌───────────┐ │   ┌───────────────────────────┐     ┌─────────────────────┐ │
│ │                          │     │                              │          │                                         │               │                                             │││                                   │ │ │ │     │     │      │     │      │     │    │     │         │     │           │     │           │ │   │                           │     │                     │ │
│ │ SCAN_REQUEST<br/>PA → RA │     │ PROOF_SUBMISSION<br/>RA → VA │          │      VALIDATION_RESULT<br/>VA → RA      │               │      STATUS_UPDATE<br/>Any → Dashboard    ┌─┼┤│Agent Message Bus<br/>Redis PubSub │ │ │ │ Msg │◄─┐  │ type │     │ from │     │ to │     │ payload │     │ signature │     │ timestamp │ │┌──┤ End-to-End<br/>Encryption │  ┌──┤ Message<br/>Signing │ │
│ │                          │     │                              │          │                                         │               │                                           │ │││                                   │ │ │ │     │  │  │      │     │      │     │    │     │         │     │           │     │           │ ││  │                           │  │  │                     │ │
│ └──────────────────────────┘     └──────────────────────────────┘          └─────────────────────────────────────────┘               └───────────────────────────────────────────┼─┘└┼───────────────────────────────────┘ │ │ └──┬──┘  │  └──────┘     └──────┘     └────┘     └─────────┘     └───────────┘     └───────────┘ ││  └───────────────────────────┘  │  └─────────────────────┘ │
│                                                                                                                                                                                  │   │                 ▲                   │ │    │     │                                                                                       ││                                 │                          │
├──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┼───┘                 │                   │ ├────┼─────┼───────────────────────────────────────────────────────────────────────────────────────┘│                                 │                          │
│                                                                                                                                                                                  │                     │                   │ │    │     │                                                                                        │                                 │                          │
│                                                                                                                                                                                  │                     │                   │ │    │     │                                                                                        │                                 │                          │
│               ┌───────────────┬──────────────────┬─────────────────┬───────────────────────Subscribe─────────Subscribe───────┬────PuSubscribe────────────────────────────────────┴─────────────────────┘                   │ │    │     └────────────────────────────────────────────────────────────────────────────────────────┴─────────────────────────────────┘                          │
│               │               │                  │                 │                            │                            │                                                                                             │ │    │                                                                                                                                                           │
│               │               │                  │                 │                            │                            │                                                                                             │ │    │                                                                                                                                                           │
│               │               │                  │                 │                            │                            │                                                                                             │ │    │                                                                                                                                                           │
│               ▼               │                  ▼                 │                            ▼                            │                                                                                             │ │    │                                                                                                                                                           │
│ ┌──────────────────────────┐  │  ┌──────────────────────────────┐  │       ┌─────────────────────────────────────────┐       │       ┌─────────────────────────────────────────────┐                                       │ │    │                                                                                                                                                           │
│ │                          │  │  │                              │  │       │                                         │       │       │                                             │                                       │ │    │                                                                                                                                                           │
│ │      Protocol Agent      ├──┘  │       Researcher Agent       ├──┘       │             Validator Agent             ├Publish┘       │          Signature<br/>Verification     ◄───┼───────────────────────────────────────┼─┼────┘                                                                                                                                                           │
│ │                          │     │                              │          │                                         │               │                                             │                                       │ │                                                                                                                                                                │
│ └──────────────────────────┘     └──────────────────────────────┘          └─────────────────────────────────────────┘               └─────────────────────────────────────────────┘                                       │ │                                                                                                                                                                │
│                                                                                                                                                                                                                            │ │                                                                                                                                                                │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘ └────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


### A2A Message Flow


```
┌────────────────┐                         ┌─────────────┐                               ┌──────────────────┐       ┌─────────────────┐               
│ Protocol Agent │                         │ Message Bus │                               │ Researcher Agent │       │ Validator Agent │               
└────────┬───────┘                         └──────┬──────┘                               └─────────┬────────┘       └────────┬────────┘               
         │                                        │                                                │                         │                        
         │  SCAN_REQUEST {protocolId, priority}   │                                                │                         │                        
         │────────────────────────────────────────▶                                                │                         │                        
         │                                        │                                                │                         │                        
         │                                        │             Deliver SCAN_REQUEST               │                         │                        
         │                                        │────────────────────────────────────────────────▶                         │                        
         │                                        │                                                │                         │                        
         │                                        │                                                ├───┐                     │                        
         │                                        │                                                │   │ Begin scanning protocol                      
         │                                        │                                                ◀───┘                     │                        
         │                                        │                                                │                         │                        
         │                                        │     ┌─────────────────────┐                    │                         │                        
         │                                        │     │ Vulnerability Found │                    │                         │                        
         │                                        │     └─────────────────────┘                    │                         │                        
         │                                        │                                                │                         │                        
         │                                        │                                                ├───┐                     │                        
         │                                        │                                                │   │ Generate encrypted proof                     
         │                                        │                                                ◀───┘                     │                        
         │                                        │                                                │                         │                        
         │                                        │  PROOF_SUBMISSION {proofHash, encryptedData}   │                         │                        
         │                                        ◀────────────────────────────────────────────────│                         │                        
         │                                        │                                                │                         │                        
         │                                        │                        Deliver PROOF_SUBMISSION│                         │                        
         │                                        │──────────────────────────────────────────────────────────────────────────▶                        
         │                                        │                                                │                         │                        
         │                                        │     ┌────────────────────┐                     │                         │                        
         │                                        │     │ Validation Process │                     │                         │                        
         │                                        │     └────────────────────┘                     │                         │                        
         │                                        │                                                │                         │                        
         │                                        │                                                │                         ├───┐                    
         │                                        │                                                │                         │   │ Spawn sandbox      
         │                                        │                                                │                         ◀───┘                    
         │                                        │                                                │                         │                        
         │                                        │                                                │                         ├───┐                    
         │                                        │                                                │                         │   │ Execute exploit    
         │                                        │                                                │                         ◀───┘                    
         │                                        │                                                │                         │                        
         │                                        │                                                │                         ├───┐                    
         │                                        │                                                │                         │   │ Record result      
         │                                        │                                                │                         ◀───┘                    
         │                                        │                                                │                         │                        
         │                                        │               VALIDATION_RESULT {proofHash, status: TRUE}                │                        
         │                                        ◀──────────────────────────────────────────────────────────────────────────│                        
         │                                        │                                                │                         │                        
         │                                        │           Deliver VALIDATION_RESULT            │                         │                        
         │                                        │────────────────────────────────────────────────▶                         │                        
         │                                        │                                                │                         │                        
         │       Deliver VALIDATION_RESULT        │                                                │                         │                        
         ◀────────────────────────────────────────│                                                │                         │                        
         │                                        │                                                │                         │                        
         │                                        ┌─────────────────────────────────┐              │                         │                        
         │                                        │ Payment Triggered Automatically │              │                         │                        
         │                                        └─────────────────────────────────┘              │                         │                        
         │                                        │                                                │                         │                        
┌────────┴───────┐                         ┌──────┴──────┐                               ┌─────────┴────────┐       ┌────────┴────────┐               
│ Protocol Agent │                         │ Message Bus │                               │ Researcher Agent │       │ Validator Agent │               
└────────────────┘                         └─────────────┘                               └──────────────────┘       └─────────────────┘               
```


---

## 7. Dashboard Real-time Updates


```
┌───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                     "Backend Events"                                                                      │
│                                                                                                                                                           │
│                                                                                                                                                           │
│ ┌────────────────────────────────┐     ┌────────────────────┐     ┌──────────────────────────┐     ┌────────────────────────┐     ┌─────────────────────┐ │
│ │                                │     │                    │     │                          │     │                        │     │                     │ │
│ │      Protocol Registered       │     │    Scan Started    │     │   Vulnerability Found    │     │  Validation Complete   │     │   Payment Released  │ │
│ │                                │     │                    │     │                          │     │                        │     │                     │ │
│ └────────────────┬───────────────┘     └──────────┬─────────┘     └─────────────┬────────────┘     └────────────┬───────────┘     └──────────┬──────────┘ │
│                  │                                │                             │                               │                            │            │
└──────────────────┼────────────────────────────────┼─────────────────────────────┼───────────────────────────────┼────────────────────────────┼────────────┘
                   │                                │                             │                               │                            │             
                   │                                │                             │                               │                            │             
                   │                                │                             │                               │                            │             
┌──────────────────┼─────────────────┐              │                             │                               │                            │             
│        "Socket.io│Server"          │              │                             │                               │                            │             
│                  │                 │              │                             │                               │                            │             
│                  ▼                 │              │                             │                               │                            │             
│ ┌────────────────────────────────┐ │              │                             │                               │                            │             
│ │                                │ │              │                             │                               │                            │             
│ │ WebSocket Server<br/>Port 4000 ├◄┼───┬──────────┼─────────────────────────────┴───────────────────────────────┴────────────────────────────┘             
│ │                                │ │   │          │                                                                                                        
│ └────────────────┬───────────────┘ │   └──────────┼─────────────────────────────┬───────────────────────────────┬────────────────────────────┐             
│                  │                 │              │                             │                               │                            │             
└──────────────────┼─────────────────┘              │                             │                               │                            │             
                   │                                │                             │                               │                            │             
                   │                                │                             │                               │                            │             
                   │                                │                             │                               │                            │             
┌──────────────────┼────────────────────────────────┼─────────────────────────────┼───────────────────────────────┼────────────────────────────┼────────────┐
│                  │                                │                  "Event Routing"                            │                            │            │
│                  │                                │                             │                               │                            │            │
│                  ▼                                ▼                             ▼                               ▼                            ▼            │
│ ┌────────────────────────────────┐     ┌────────────────────┐     ┌──────────────────────────┐     ┌────────────────────────┐     ┌─────────────────────┐ │
│ │                                │     │                    │     │                          │     │                        │     │                     │ │
│ │        Room: protocols         │     │    Room: scans     │     │  Room: vulnerabilities   │     │     Room: payments     │     │     Room: agents    │ │
│ │                                │     │                    │     │                          │     │                        │     │                     │ │
│ └────────────────┬───────────────┘     └──────────┬─────────┘     └─────────────┬────────────┘     └────────────┬───────────┘     └──────────┬──────────┘ │
│                  │                                │                             │                               │                            │            │
└──────────────────┼────────────────────────────────┼─────────────────────────────┼───────────────────────────────┼────────────────────────────┼────────────┘
                   │                                │                             │                               │                            │             
                   │                                │                             │                               │                            │             
                   │                                │                             │                               │                            │             
┌──────────────────┼────────────────────────────────┼─────────────────────────────┼───────────────────────────────┼────────────────────────────┼────────────┐
│                  │                                │                "Frontend Handlers"                          │                            │            │
│                  │                                │                             │                               │                            │            │
│                  ▼                                ▼                             ▼                               ▼                            ▼            │
│ ┌────────────────────────────────┐     ┌────────────────────┐     ┌──────────────────────────┐     ┌────────────────────────┐     ┌─────────────────────┐ │
│ │                                │     │                    │     │                          │     │                        │     │                     │ │
│ │      Update Protocol List      │     │ Update Scan Status │     │ Show Alert + Update List │     │ Update Payment History │     │ Update Agent Status │ │
│ │                                │     │                    │     │                          │     │                        │     │                     │ │
│ └────────────────┬───────────────┘     └──────────┬─────────┘     └─────────────┬────────────┘     └────────────┬───────────┘     └──────────┬──────────┘ │
│                  │                                │                             │                               │                            │            │
└──────────────────┼────────────────────────────────┼─────────────────────────────┼───────────────────────────────┼────────────────────────────┼────────────┘
                   │                                │                             │                               │                            │             
                   │                                │                             │                               │                            │             
                   │                                │                             │                               │                            │             
┌──────────────────┼────────────────────────────────┼─────────────────────────────┼───────────────────────────────┼────────────────────────────┼────────────┐
│                  │                                │              "Dashboard Components"                         │                            │            │
│                  │                                │                             │                               │                            │            │
│                  ▼                                ▼                             ▼                               ▼                            ▼            │
│ ┌────────────────────────────────┐     ┌────────────────────┐     ┌──────────────────────────┐     ┌────────────────────────┐     ┌─────────────────────┐ │
│ │                                │     │                    │     │                          │     │                        │     │                     │ │
│ │         ProtocolTable          │     │    ScanProgress    │     │    VulnerabilityAlert    │     │     PaymentHistory     │     │   AgentStatusCards  │ │
│ │                                │     │                    │     │                          │     │                        │     │                     │ │
│ └────────────────────────────────┘     └────────────────────┘     └──────────────────────────┘     └────────────────────────┘     └─────────────────────┘ │
│                                                                                                                                                           │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


### WebSocket Event Types


```
┌────────────────────┐                                                                                                        
│ WebSocketEvent     │                                                                                                        
├────────────────────┤                                                                                                        
│ +type: string      │                                                                                                        
│ +room: string      │                                                                                                        
│ +payload: object   │                                                                                                        
│ +timestamp: number │                                                                                                        
└────────────────────┘                                                                                                        
           △                                                                                                                  
           └─────────────────────────────────────────────────────────────────────────────────────────────────────┐            
            │                        │                         │                         │                       │            
┌──────────────────────┐    ┌─────────────────┐    ┌──────────────────────┐    ┌───────────────────┐    ┌────────────────┐    
│ ProtocolEvent        │    │ ScanEvent       │    │ VulnerabilityEvent   │    │ PaymentEvent      │    │ AgentEvent     │    
├──────────────────────┤    ├─────────────────┤    ├──────────────────────┤    ├───────────────────┤    ├────────────────┤    
│ +protocol_registered │    │ +scan_started   │    │ +vulnerability_found │    │ +payment_pending  │    │ +agent_online  │    
│ +protocol_updated    │    │ +scan_progress  │    │ +validation_pending  │    │ +payment_released │    │ +agent_offline │    
│ +pool_funded         │    │ +scan_completed │    │ +validation_complete │    │ +payment_failed   │    │ +agent_busy    │    
└──────────────────────┘    └─────────────────┘    └──────────────────────┘    └───────────────────┘    └────────────────┘    
                                                                                                                              
                                                                                                                              
```


---

## 8. Error Handling & Recovery


```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐                                          
│                                                                                                         "Error Categories"                                                                                                          │                                          
│                                                                                                                                                                                                                                     │                                          
│                                                                                                                                                                                                                                     │                                          
│ ┌──────────────────────────────────────────┐                     ┌─────────────────────────────────────────────────────────┐         ┌─────────────────────────────────────────────┐          ┌───────────────────────────────────┐ │                                          
│ │                                          │                     │                                                         │         │                                             │          │                                   │ │                                          
│ │ Network Errors<br/>RPC Timeout, API Down │                     │     Validation Errors<br/>Invalid Proof, Bad Format     │         │ Blockchain Errors<br/>Tx Failed, Gas Issues │          │  Agent Errors<br/>Crash, Timeout  │ │                                          
│ │                                          │                     │                                                         │         │                                             │          │                                   │ │                                          
│ └─────────────────────┬────────────────────┘                     └────────────────────────────┬────────────────────────────┘         └──────────────────────┬──────────────────────┘          └─────────────────┬─────────────────┘ │                                          
│                       │                                                                       │                                                             │                                                   │                   │                                          
└───────────────────────┼───────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────┼───────────────────┘                                          
                        │                                                                       │                                                             │                                                   │                                                              
                        │                                                                       │                                                             │                                                   │                                                              
                        │                                                                       │                                                             │                                                   │                                                              
┌───────────────────────┼──────────────────────┐                                                │                                                             │                                                   │                                                              
│              "Error Detection"               │                                                │                                                             │                                                   │                                                              
│                       │                      │                                                │                                                             │                                                   │                                                              
│                       ▼                      │                                                │                                                             │                                                   │                                                              
│ ┌──────────────────────────────────────────┐ │                                                │                                                             │                                                   │                                                              
│ │                                          │ │                                                │                                                             │                                                   │                                                              
│ │       Error Handler<br/>Middleware       │ │ ◄──────────────────────────────────────────────┴─────────────────────────────────────────────────────────────┴───────────────────────────────────────────────────┘                                                              
│ │                                          │ │                                                                                                                                                                                                                                 
│ └─────────────────────┬────────────────────┘ │                                                                                                                                                                                                                                 
│                       │                      │                                                                                                                                                                                                                                 
└───────────────────────┼──────────────────────┘                                                                                                                                                                                                                                 
                        │                                                                                                                                                                                                                                                        
                        │                                                                                                                                                                                                                                                        
                        │                                                                                                                                                                                                                                                        
┌───────────────────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐                                          
│                       │                                                                                "Recovery Strategies"                                                                                                        │                                          
│                       │                                                                                                                                                                                                             │                                          
│                       ▼                                                                                                                                                                                                             │                                          
│ ┌──────────────────────────────────────────┐                                                                                                                                                                                        │                                          
│ │                                          │                                                                                                                                                                                        │                                          
│ │                Error Type                │  ├───BloAgentin─────┬Permanent───────────────────┐                                                                                                                                     │                                          
│ │                                          │                     │                            │                                                                                                                                     │                                          
│ └─────────────────────┬────────────────────┘                     └────────────────────────────┼─────────────────────────────────────────────────────────────┬───────────────────────────────────────────────────┐                   │                                          
│                       │                                                                       │                                                             │                                                   │                   │                                          
│                       │                                                                       │                                                             │                                                   │                   │                                          
│                   Transient                                                                   │                                                             │                                                   │                   │                                          
│                       │                                                                       │                                                             │                                                   │                   │                                          
│                       ▼                                                                       ▼                                                             ▼                                                   ▼                   │                                          
│ ┌──────────────────────────────────────────┐                     ┌─────────────────────────────────────────────────────────┐         ┌─────────────────────────────────────────────┐          ┌───────────────────────────────────┐ │                                          
│ │                                          │                     │                                                         │         │                                             │          │                                   │ │                                          
│ │     Exponential Backoff<br/>Retry 3x     │  ├─Fail───┐         │                Log Error<br/>Alert Admin                ├──────┬──┤         Increase Gas<br/>Resubmit Tx        │  Fail─┬──┤   Restart Agent<br/>Resume State  ├─┼───────Fail───────────┐                   
│ │                                          │           │         │                                                         │      │  │                                             │       │  │                                   │ │                      │                   
│ └─────────────────────┬────────────────────┘           │         └─────────────────────────────────────────────────────────┘      │  └─────────────────────────────────────────────┘       │  └───────────────────────────────────┘ │                      │                   
│                       │                                │                                                                          │                                                        │                                        │                      │                   
└───────────────────────┼────────────────────────────────┼──────────────────────────────────────────────────────────────────────────┼────────────────────────────────────────────────────────┼────────────────────────────────────────┘                      │                   
                        │                                │                                                                          │                                                        │                                                               │                   
                        │                                │                                                                          │                                                        │                                                               │                   
                     Success─────────────────────────────┴─────────────────Success──────────────┬──────Success──────────────────────┴─────────────────────────┬──────────────────────────────┴────────────────────┐                                          │                   
┌───────────────────────┼───────────────────────────────────────────────────────────────────────┼─────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────┼──────────────────────────────────────────┼──────────────────┐
│                       │                                                                       │                              "Fallback Actions"             │                                                   │                                          │                  │
│                       │                                                                       │                                                             │                                                   │                                          │                  │
│                       ▼                                                                       ▼                                                             ▼                                                   ▼                                          ▼                  │
│ ┌──────────────────────────────────────────┐                     ┌─────────────────────────────────────────────────────────┐         ┌─────────────────────────────────────────────┐          ┌───────────────────────────────────┐      ┌──────────────────────────────────┐ │
│ │                                          │                     │                                                         │         │                                             │          │                                   │      │                                  │ │
│ │              Continue Flow               │                     │           Fallback RPC<br/>or Queue for Later           │         │        Notify Admin<br/>Discord/Slack       │          │ Queue Refund<br/>or Manual Review │      │ Manual Intervention<br/>Required │ │
│ │                                          │                     │                                                         │         │                                             │          │                                   │      │                                  │ │
│ └─────────────────────┬────────────────────┘                     └────────────────────────────┬────────────────────────────┘         └─────────────────────────────────────────────┘          └───────────────────────────────────┘      └──────────────────────────────────┘ │
│                       │                                                                       │                                                                                                                                                                               │
└───────────────────────┼───────────────────────────────────────────────────────────────────────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                        │                                                                       │                                                                                                                                                                                
                        │                                                                       │                                                                                                                                                                                
                        │                                                                       │                                                                                                                                                                                
┌───────────────────────┼──────────────────────┐                                                │                                                                                                                                                                                
│              "State Recovery"                │                                                │                                                                                                                                                                                
│                       │                      │                                                │                                                                                                                                                                                
│                       ▼                      │                                                │                                                                                                                                                                                
│ ┌──────────────────────────────────────────┐ │                                                │                                                                                                                                                                                
│ │                                          │ │                                                │                                                                                                                                                                                
│ │     Save Checkpoint<br/>Redis State      │ │ ◄──────────────────────────────────────────────┘                                                                                                                                                                                
│ │                                          │ │                                                                                                                                                                                                                                 
│ └─────────────────────┬────────────────────┘ │                                                                                                                                                                                                                                 
│                       │                      │                                                                                                                                                                                                                                 
│                       │                      │                                                                                                                                                                                                                                 
│                       │                      │                                                                                                                                                                                                                                 
│                       │                      │                                                                                                                                                                                                                                 
│                       ▼                      │                                                                                                                                                                                                                                 
│ ┌──────────────────────────────────────────┐ │                                                                                                                                                                                                                                 
│ │                                          │ │                                                                                                                                                                                                                                 
│ │     Resume from<br/>Last Good State      │ │                                                                                                                                                                                                                                 
│ │                                          │ │                                                                                                                                                                                                                                 
│ └──────────────────────────────────────────┘ │                                                                                                                                                                                                                                 
│                                              │                                                                                                                                                                                                                                 
└──────────────────────────────────────────────┘                                                                                                                                                                                                                                 
```


### Retry Configuration


```
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                                                              "Retry Policy"                                                                                                                │
│                                                                                                                                                                                                                                            │
│                                                                                                                                                                                                                                            │
│ ┌─────────────────────────┐      ┌────────────────────────────┐      ┌────────────────────────────┐         ┌──────────────────────────────────┐     ┌───────────┐      ┌─────────┐     ┌───────────┐      ┌─────────────────────────────┐ │
│ │                         │      │                            │      │                            │         │                                  │     │           │      │         │     │           │      │                             │ │
│ │ Attempt 1<br/>Immediate ├Fail─►│          Wait 1s           ├─────►│         Attempt 2          ├──Fail──►│             Wait 2s              ├────►│ Attempt 3 ├Fail─►│ Wait 4s ├────►│ Attempt 4 ├Fail─►│ Max Retries<br/>Queue/Alert │ │
│ │                         │      │                            │      │                            │         │                                  │     │           │      │         │     │           │      │                             │ │
│ └─────────────────────────┘      └────────────────────────────┘      └────────────────────────────┘         └──────────────────────────────────┘     └───────────┘      └─────────┘     └───────────┘      └─────────────────────────────┘ │
│                                                                                                                                                                                                                                            │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
                                                                                                                                                                                                                                              
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐                                                                                          
│                                                                "Circuit Breaker"                                                                 │                                                                                          
│ ┌─────────────────────────┐      ┌────────────────────────────┐      ┌────────────────────────────┐         ┌──────────────────────────────────┐ │                                                                                          
│ │                         │      │                            │      │                            │         │                                  │ │                                                                                          
│ │  Error Rate<br/>Monitor ├>50%─►│ Circuit Open<br/>Fail Fast ├Fail─►┤ Half Open<br/>Test Request ├─Success►│ Circuit Closed<br/>Resume Normal │ │                                                                                          
│ │                         │      │                            │      │                            │         │                                  │ │                                                                                          
│ └─────────────────────────┘      └────────────────────────────┘      └────────────────────────────┘         └──────────────────────────────────┘ │                                                                                          
│                                                                                                                                                  │                                                                                          
└──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘                                                                                          
```


---

## Complete System Flow Summary

**Hybrid Architecture: Local Anvil (31337) + Base Sepolia (84532)**

```mermaid
flowchart TB
    subgraph "Phase 1: Setup (BASE SEPOLIA)"
        P1A[Protocol Owner<br/>Registers on Sepolia]
        P1B[Funds Bounty Pool<br/>with Sepolia USDC]
    end

    subgraph "Phase 1b: Deploy Target (LOCAL ANVIL)"
        P1C[Deploy Target Contract<br/>to Local Anvil]
    end

    subgraph "Phase 2: Scanning (LOCAL ANVIL)"
        P2A[Researcher Agent<br/>Queries Protocols]
        P2B[Scan Target on<br/>Local Anvil]
        P2C[Vulnerability<br/>Detected]
    end

    subgraph "Phase 3: Proof"
        P3A[Generate Exploit<br/>PoC]
        P3B[Encrypt & Store<br/>in IPFS]
        P3C[Submit to<br/>Validator]
    end

    subgraph "Phase 4: Validation (LOCAL ANVIL)"
        P4A[Spawn Sandbox<br/>Fork Local State]
        P4B[Execute Exploit<br/>on Sandbox]
        P4C[Capture Result<br/>TRUE/FALSE]
    end

    subgraph "Phase 5: Registry (BASE SEPOLIA)"
        P5A[Update ERC-8004<br/>on Sepolia]
    end

    subgraph "Phase 6: Payment (BASE SEPOLIA)"
        P6A[BountyPool<br/>Triggers x402]
        P6B[USDC Transfer<br/>on Sepolia]
        P6C[All Parties<br/>Notified]
    end

    P1A --> P1B --> P1C
    P1C --> P2A --> P2B --> P2C
    P2C --> P3A --> P3B --> P3C
    P3C --> P4A --> P4B --> P4C
    P4C -->|TRUE| P5A --> P6A --> P6B --> P6C
    P4C -->|FALSE| P2B

    P6C --> P2B

    style P1A fill:#ffe1f0
    style P1B fill:#ffe1f0
    style P1C fill:#fff4e1
    style P2B fill:#fff4e1
    style P2C fill:#ffe1e1
    style P4A fill:#fff4e1
    style P4B fill:#fff4e1
    style P5A fill:#ffe1f0
    style P6A fill:#ffe1f0
    style P6B fill:#ffe1f0
```

### Chain Separation Summary

| Phase | Chain | Purpose |
|-------|-------|---------|
| Protocol Registration | Base Sepolia (84532) | Metadata + bounty terms |
| Bounty Funding | Base Sepolia (84532) | USDC deposit |
| Target Deployment | Local Anvil (31337) | Contracts to scan |
| Vulnerability Scanning | Local Anvil (31337) | Fast local analysis |
| Exploit Validation | Local Anvil Sandbox (31338) | Isolated exploit execution |
| Registry Update | Base Sepolia (84532) | ERC-8004 state change |
| Payment Release | Base Sepolia (84532) | x402 USDC transfer |

### Why This Architecture?

1. **Fast Iteration**: Target contracts on local Anvil = instant feedback
2. **Real Payment Testing**: USDC on Sepolia = realistic payment flow
3. **Isolation**: Sandbox on separate Anvil = no state pollution
4. **Clear Upgrade Path**: Sepolia → Mainnet is straightforward
---

## 9. Deduplication & Fairness Policy

### First-to-Commit Principle
The platform operates on a "First-to-Commit" basis on the blockchain. The immutable timestamp of the `submitValidation` transaction on Base Sepolia serves as the definitive reference for priority.

### The 1-Minute Race Condition Scenario
If Researcher A and Researcher B find the same bug within a short interval (e.g., 1 minute):

1. **Submission Phase**:
   - Both researchers submit their encrypted proofs to the `ValidationRegistry`.
   - **Researcher A** (Block N, 12:00:00 PM): `submitValidation` confirmed.
   - **Researcher B** (Block N+5, 12:01:00 PM): `submitValidation` confirmed.

2. **Validation Phase**:
   - The Validator Agent processes submissions in order of their on-chain `submittedAt` timestamp.
   - **Researcher A's Proof**: Validated as `TRUE`. Payment of $X is triggered immediately.
   - **Researcher B's Proof**: Validated as `TRUE` (the exploit works). However, the Validator Agent maps the vulnerability (Type, File, Line Range) and finds a match with the already-paid Researcher A.

3. **Resolution**:
   - **Researcher B's status** is set to `Duplicate`.
   - The `ValidationResult` on-chain is updated to `Duplicate`.
   - Researcher B receives notification: "Vulnerability validated, but marked as duplicate of Validation ID [A_ID]."

### Transparency & Proof of Precedence
Researchers can independently verify the fairness of the system:
- **On-Chain Audit**: Anyone can query the `ValidationRegistry` for `submittedAt` timestamps using the `validationId`.
- **Deduplication Proof**: When a finding is marked as `Duplicate`, the Validator Agent must provide the `originalValidationId` it was deduplicated against.
- **Timestamp Guarantee**: Since timestamps are generated by the Base Sepolia network (immutable), the platform cannot retroactively "favour" one researcher over another.

### Definition of a Unique Vulnerability (Canonical Fingerprint)

To remove AI subjectivity from deduplication, the system uses a **Deterministic Vulnerability Hash**.

**Formula**:
```solidity
bytes32 vulnerabilityHash = keccak256(abi.encodePacked(
    chainId,                // 84532
    targetContractAddress,  // 0x... (The deployed address on Anvil being scanned)
    vulnerabilityType,      // e.g., "REENTRANCY_ETH" (Standardized Enum)
    functionSelector        // e.g., "0x3ccfd60b" (withdraw())
));
```

**Normalization Rules**:
1. **Function Granularity**: Bugs are deduplicated at the *function level*. Two different exploit vectors targeting the exact same function vulnerability are considered duplicates.
2. **Type Standardization**: The Researcher Agent must classify the bug into a standard enum (e.g., `OWASP_L01_REENTRANCY`, `ERC_E04_UNCHECKED_TRANSFER`) to generate the hash.

**Fairness Guarantee**:
If Researcher A and Researcher B find a bug with the same `vulnerabilityHash`, the system relies entirely on the on-chain `submittedAt` timestamp to decide the winner.

---

## 10. Front-Running Protection (Anti-MEV)

To prevent MEV bots from observing a `submitValidation` transaction and front-running it with their own address to claim the bounty, the platform enforces **Identity Binding** within the encrypted payload.

### The Mechanism

1. **Proof Generation (Researcher Side)**:
   - Researcher generates the exploit proof.
   - Researcher signs a hash of the proof + their wallet address.
   - Researcher includes this signature inside the payload *before* encryption.

2. **Submission (Public Mempool)**:
   - Researcher submits `submitValidation(..., proofHash, researcher=0xResearcher, ...)` to the blockchain.
   - MEV Bot sees this and submits `submitValidation(..., proofHash, researcher=0xBot, ...)` with higher gas.

3. **Validation (Validator Side)**:
   - Validator Agent picks up the Bot's transaction (mined first).
   - Validator decrypts the payload (only Validator has the key).
   - **CRITICAL CHECK**: Validator compares `tx.researcher` (0xBot) with `payload.identity.researcher` (0xResearcher).
   - **Mismatch Found**: The payload explicitly belongs to 0xResearcher, but the transaction claims to be 0xBot.

4. **Outcome**:
   - The Validator Agent **REJECTS** the Bot's submission (Status: `False` or `Error`).
   - The Validator Agent proceeds to the next submission (the original Researcher's).
   - The check passes (0xResearcher == 0xResearcher).
   - The Validator approves the original submission and pays the Researcher.

If Researcher B finds a *different* root cause that leads to the same impact, it may be considered a unique finding at the discretion of the Protocol Agent rules.
