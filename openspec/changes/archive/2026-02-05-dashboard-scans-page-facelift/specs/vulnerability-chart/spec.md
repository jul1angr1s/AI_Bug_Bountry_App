# Vulnerability Chart Specification

## ADDED Requirements

### Requirement: Display vulnerability detection rate as line chart

The system SHALL display a line chart showing the cumulative count of vulnerabilities detected over time during the scan.

#### Scenario: Chart displays cumulative vulnerability count
- **WHEN** the vulnerability chart is rendered with findings data
- **THEN** the system displays a line chart with time on X-axis and cumulative vulnerability count on Y-axis

#### Scenario: Chart uses SVG rendering
- **WHEN** the chart is rendered
- **THEN** the system uses SVG elements (path, circle, linearGradient) rather than canvas or third-party charting library

#### Scenario: Chart has fixed dimensions
- **WHEN** the chart container is rendered
- **THEN** the system uses a fixed aspect ratio (478px width × 120px height for desktop, scales responsively)

---

### Requirement: Display chart with gradient fill

The system SHALL display the area under the line chart with a gradient fill from primary color to transparent.

#### Scenario: Chart has gradient fill under line
- **WHEN** the chart is rendered
- **THEN** the system displays an area fill using a linear gradient from primary blue (#0663f9 at 30% opacity) at the top to transparent at the bottom

#### Scenario: Chart line uses solid color
- **WHEN** the chart line path is rendered
- **THEN** the system uses solid primary blue (#0663f9) with 2px stroke width and round line caps

---

### Requirement: Display current value indicator

The system SHALL display a visual indicator at the rightmost point of the chart showing the current total findings count.

#### Scenario: Chart displays endpoint circle
- **WHEN** the chart has at least one data point
- **THEN** the system displays a white-filled circle (4px radius) with primary blue border (2px) at the last data point

#### Scenario: Chart displays total count
- **WHEN** the chart is rendered
- **THEN** the system displays the total findings count as a large number (3xl font) in the top-right corner of the chart card

#### Scenario: Chart displays trend indicator
- **WHEN** new findings have been detected since the last update
- **THEN** the system displays a "+{count} new" badge in green with trending-up icon

---

### Requirement: Derive chart data from findings array

The system SHALL compute the chart data points by aggregating findings by timestamp.

#### Scenario: Chart groups findings into time buckets
- **WHEN** the chart receives findings data with `createdAt` timestamps
- **THEN** the system groups findings into 5-minute intervals for time bucketing

#### Scenario: Chart calculates cumulative counts
- **WHEN** the chart processes time-bucketed findings
- **THEN** the system calculates cumulative count for each bucket (sum of current + all previous buckets)

#### Scenario: Chart handles empty findings array
- **WHEN** the findings array is empty or undefined
- **THEN** the system displays a flat line at zero with placeholder text "No vulnerabilities detected yet"

#### Scenario: Chart handles single finding
- **WHEN** the findings array contains only one item
- **THEN** the system displays a straight horizontal line at count = 1 from start to current time

---

### Requirement: Display chart metadata

The system SHALL display contextual metadata about the vulnerability detection rate.

#### Scenario: Chart displays time window
- **WHEN** the chart is rendered
- **THEN** the system displays "Issues found over the last 30 minutes" or dynamic time window based on scan duration

#### Scenario: Chart displays data labels
- **WHEN** the chart is rendered
- **THEN** the system displays axis labels or time markers (e.g., "0m", "15m", "30m") along the X-axis

---

### Requirement: Support responsive chart sizing

The system SHALL adapt the chart size and layout for different screen sizes.

#### Scenario: Desktop chart uses full width
- **WHEN** the viewport width is >= 1024px
- **THEN** the system displays the chart at full card width with 478px × 120px aspect ratio

#### Scenario: Mobile chart scales proportionally
- **WHEN** the viewport width is < 768px
- **THEN** the system scales the chart to fit card width while maintaining aspect ratio

---

### Requirement: Update chart in real-time

The system SHALL update the chart data as new findings are detected during the scan.

#### Scenario: Chart adds new data point on finding creation
- **WHEN** a new finding is added via WebSocket or API update
- **THEN** the system recalculates chart data and re-renders the SVG path with smooth transition

#### Scenario: Chart transition uses animation
- **WHEN** the chart data changes
- **THEN** the system animates the path change over 300ms for smooth visual update (optional enhancement)

---

### Requirement: Provide accessible chart description

The system SHALL ensure the chart is accessible to screen reader users.

#### Scenario: Chart has descriptive title
- **WHEN** the chart is rendered
- **THEN** the system displays "Vulnerability Detection Rate" as the card heading

#### Scenario: Chart has ARIA label
- **WHEN** the chart SVG is rendered
- **THEN** the system includes `aria-label` describing the chart (e.g., "Line chart showing 12 vulnerabilities detected over 30 minutes")

#### Scenario: Chart data available as text
- **WHEN** the chart is rendered
- **THEN** the system displays the current total count (12) as text in addition to the visual chart
